!function(a){a.fn.formset=function(b){var c=a.extend({},a.fn.formset.defaults,b),d=a(this),e=d.parent(),f=function(b,c,d){var e=new RegExp("("+c+"-(\\d+|__prefix__))"),f=c+"-"+d;a(b).prop("for")&&a(b).prop("for",a(b).prop("for").replace(e,f)),b.id&&(b.id=b.id.replace(e,f)),b.name&&(b.name=b.name.replace(e,f))},g=a("#id_"+c.prefix+"-TOTAL_FORMS").prop("autocomplete","off"),h=parseInt(g.val(),10),i=a("#id_"+c.prefix+"-MAX_NUM_FORMS").prop("autocomplete","off"),j=""===i.val()||i.val()-g.val()>0;if(d.each(function(){a(this).not("."+c.emptyCssClass).addClass(c.formCssClass)}),d.length&&j){var k;if("TR"==d.prop("tagName")){var l=this.eq(-1).children().length;e.append('<tr class="'+c.addCssClass+'"><td colspan="'+l+'"><a href="javascript:void(0)">'+c.addText+"</a></tr>"),k=e.find("tr:last a")}else d.filter(":last").after('<div class="'+c.addCssClass+'"><a href="javascript:void(0)">'+c.addText+"</a></div>"),k=d.filter(":last").next().find("a");k.click(function(b){b.preventDefault();var d=a("#id_"+c.prefix+"-TOTAL_FORMS"),e=a("#"+c.prefix+"-empty"),g=e.clone(!0);g.removeClass(c.emptyCssClass).addClass(c.formCssClass).attr("id",c.prefix+"-"+h),g.is("tr")?g.children(":last").append('<div><a class="'+c.deleteCssClass+'" href="javascript:void(0)">'+c.deleteText+"</a></div>"):g.is("ul")||g.is("ol")?g.append('<li><a class="'+c.deleteCssClass+'" href="javascript:void(0)">'+c.deleteText+"</a></li>"):g.children(":first").append('<span><a class="'+c.deleteCssClass+'" href="javascript:void(0)">'+c.deleteText+"</a></span>"),g.find("*").each(function(){f(this,c.prefix,d.val())}),g.insertBefore(a(e)),a(d).val(parseInt(d.val(),10)+1),h+=1,""!==i.val()&&i.val()-d.val()<=0&&k.parent().hide(),g.find("a."+c.deleteCssClass).click(function(b){b.preventDefault();var d=a(this).parents("."+c.formCssClass);d.remove(),h-=1,c.removed&&c.removed(d);var e=a("."+c.formCssClass);a("#id_"+c.prefix+"-TOTAL_FORMS").val(e.length),(""===i.val()||i.val()-e.length>0)&&k.parent().show();for(var g=0,j=e.length;j>g;g++)f(a(e).get(g),c.prefix,g),a(e.get(g)).find("*").each(function(){f(this,c.prefix,g)})}),c.added&&c.added(g)})}return this},a.fn.formset.defaults={prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",emptyCssClass:"empty-row",formCssClass:"dynamic-form",added:null,removed:null},a.fn.tabularFormset=function(b){var c=a(this),d=function(){a(c.selector).not(".add-row").removeClass("row1 row2").filter(":even").addClass("row1").end().filter(":odd").addClass("row2")},e=function(a){var b=a.find("a.fb_show");if(0!=b.length){var c=b.prev("input").attr("id").split("-");c=c[c.length-2];var d=b.attr("href");d.search(/__prefix__/)>=0&&b.attr("href",d.replace(/__prefix__/g,c))}},f=function(){"undefined"!=typeof DateTimeShortcuts&&(a(".datetimeshortcuts").remove(),DateTimeShortcuts.init())},g=function(){"undefined"!=typeof SelectFilter&&(a(".selectfilter").each(function(a,c){var d=c.name.split("-");SelectFilter.init(c.id,d[d.length-1],!1,b.adminStaticPrefix)}),a(".selectfilterstacked").each(function(a,c){var d=c.name.split("-");SelectFilter.init(c.id,d[d.length-1],!0,b.adminStaticPrefix)}))},h=function(b){b.find(".prepopulated_field").each(function(){var c=a(this),d=c.find("input, select, textarea"),e=d.data("dependency_list")||[],f=[];a.each(e,function(a,c){f.push("#"+b.find(".field-"+c).find("input, select, textarea").attr("id"))}),f.length&&d.prepopulate(f,d.attr("maxlength"))})};return c.formset({prefix:b.prefix,addText:b.addText,formCssClass:"dynamic-"+b.prefix,deleteCssClass:"inline-deletelink",deleteText:b.deleteText,emptyCssClass:"empty-form",removed:d,added:function(a){h(a),f(),g(),d(a),e(a)}}),c},a.fn.stackedFormset=function(b){var c=a(this),d=function(){a(c.selector).find(".inline_label").each(function(b){var c=b+1;a(this).html(a(this).html().replace(/(#\d+)/g,"#"+c))})},e=function(a){var b=a.find("a.fb_show");if(0!=b.length){var c=b.prev("input").attr("id").split("-");c=c[c.length-2];var d=b.attr("href");d.search(/__prefix__/)>=0&&b.attr("href",d.replace(/__prefix__/g,c))}},f=function(){"undefined"!=typeof DateTimeShortcuts&&(a(".datetimeshortcuts").remove(),DateTimeShortcuts.init())},g=function(){"undefined"!=typeof SelectFilter&&(a(".selectfilter").each(function(a,c){var d=c.name.split("-");SelectFilter.init(c.id,d[d.length-1],!1,b.adminStaticPrefix)}),a(".selectfilterstacked").each(function(a,c){var d=c.name.split("-");SelectFilter.init(c.id,d[d.length-1],!0,b.adminStaticPrefix)}))},h=function(b){b.find(".prepopulated_field").each(function(){var c=a(this),d=c.find("input, select, textarea"),e=d.data("dependency_list")||[],f=[];a.each(e,function(a,c){f.push("#"+b.find(".form-row .field-"+c).find("input, select, textarea").attr("id"))}),f.length&&d.prepopulate(f,d.attr("maxlength"))})};return c.formset({prefix:b.prefix,addText:b.addText,formCssClass:"dynamic-"+b.prefix,deleteCssClass:"inline-deletelink",deleteText:b.deleteText,emptyCssClass:"empty-form",removed:d,added:function(a){h(a),f(),g(),d(a),e(a)}}),c}}(django.jQuery);
